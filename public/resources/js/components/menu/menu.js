var menuItems = {
    "asa": [
        {
            "title": "Home",
            "icon": "resources/images/home_ico_white.png",
            "class": "dashboard",
            "link": "asa-home",
            "subItems": []
        },{
            "title": "Users",
            "icon": "resources/images/users_ico_white.png",
            "class": "users",
            "link": "",
            "subItems": [
                {"title": "New", "link": "asa-new-users"},
                {"title": "View", "link": "asa-view-users"},
                {"title": "Edit", "link": "asa-edit-users"}
            ]
        }, {
            "title": "Products",
            "icon": "resources/images/products_ico_white.png",
            "class": "products",
            "link": "asa-products",
            "subItems": [
                {"title": "New", "link": "asa-new-product"},
                {"title": "View", "link": "asa-view-products"},
                {"title": "Edit", "link": "asa-edit-products"}]
        }, {
            "title": "Suppliers",
            "icon": "resources/images/sup_ico_white.png",
            "class": "suppliers",
            "link": "asa-suppliers",
            "subItems": [
                {"title": "New", "link": "asa-new-supplier"},
                {"title": "View", "link": "asa-view-suppliers"},
                {"title": "Edit", "link": "asa-edit-suppliers"}
            ]
        }, {
            "title": "Categories",
            "icon": "resources/images/cat_ico_white.png",
            "class": "categories",
            "link": "",
            "subItems": [
                {"title": "View", "link": "asa-view-categories"},
                {"title": "Edit", "link": "asa-edit-categories"}
            ]
        },{
            "title": "Profile",
            "icon": "resources/images/prof_ico_white.png",
            "class": "profile",
            "link": "profile",
            "subItems": [
                {"title": "View", "link": "asa-view-profile"},
                {"title": "Password", "link": "change-password"},
                {"title": "Edit", "link": "asa-edit-profile"}
            ]
        },{
            "title": "Help Topics",
            "icon": "resources/images/help_ico_white.png",
            "class": "help",
            "link": "help-topics",
            "subItems": []
        }
    ],
    "lec": [
        {
            "title": "Home",
            "icon": "resources/images/home_ico_white.png",
            "class": "dashboard",
            "link": "lec-home",
            "subItems": []
        }, {
            "title": "Products",
            "icon": "resources/images/products_ico_white.png",
            "class": "products",
            "link": "products",
            "subItems": []
        }, {
            "title": "Projects",
            "icon": "resources/images/project_ico_white.png",
            "class": "projects",
            "link": "client-projects",
            "subItems": [
                {"title": "Work", "link": "lec-work-projects"},
                {"title": "Edit", "link": "lec-edit-projects"}
            ]
        }, {
            "title": "Profile",
            "icon": "resources/images/prof_ico_white.png",
            "class": "profile",
            "link": "profile",
            "subItems": [
                {"title": "View", "link": "lec-view-profile"},
                {"title": "Password", "link": "change-password"},
                {"title": "Subscriptions", "link": "my-subscriptions"},
                {"title": "Edit", "link": "lec-edit-profile"}
            ]
        }, {
            "title": "Calender",
            "icon": "resources/images/cal_ico_white.png",
            "class": "calender",
            "link": "my-calender",
            "subItems": []
        },{
            "title": "Help Topics",
            "icon": "resources/images/help_ico_white.png",
            "class": "help",
            "link": "help-topics",
            "subItems": []
        }
    ],
    "lm": [
        {
            "title": "Home",
            "icon": "resources/images/home_ico_white.png",
            "class": "dashboard",
            "link": "lm-home",
            "subItems": []
        }, {
            "title": "Products",
            "icon": "resources/images/products_ico_white.png",
            "class": "products",
            "link": "products",
            "subItems": []
        }, {
            "title": "Projects",
            "icon": "resources/images/project_ico_white.png",
            "class": "projects",
            "link": "",
            "subItems": [
                {"title": "View", "link": "lm-view-projects"}
            ]
        }, {
            "title": "Profile",
            "icon": "resources/images/prof_ico_white.png",
            "class": "profile",
            "link": "profile",
            "subItems": [
                {"title": "View", "link": "lm-view-profile"},
                {"title": "Password", "link": "change-password"},
                {"title": "Subscriptions", "link": "my-subscriptions"},
                {"title": "Edit", "link": "lm-edit-profile"}
            ]
        },{
            "title": "Help Topics",
            "icon": "resources/images/help_ico_white.png",
            "class": "help",
            "link": "help-topics",
            "subItems": []
        }
    ],
    "msl": [
        {
            "title": "Home",
            "icon": "resources/images/home_ico_white.png",
            "class": "dashboard",
            "link": "msl-home",
            "subItems": []
        },        {
            "title": "Users",
            "icon": "resources/images/users_ico_white.png",
            "class": "users",
            "link": "",
            "subItems": [
                {"title": "New", "link": "msl-new-users"},
                {"title": "View", "link": "msl-view-users"},
                {"title": "Edit", "link": "msl-edit-users"}
            ]
        }, {
            "title": "Products",
            "icon": "resources/images/products_ico_white.png",
            "class": "products",
            "link": "products",
            "subItems": []
        }, {
            "title": "Projects",
            "icon": "resources/images/project_ico_white.png",
            "class": "projects",
            "link": "admin-projects",
            "subItems": [
                {"title": "New", "link": "msl-new-project"},
                {"title": "View", "link": "msl-view-projects"},
                {"title": "Edit", "link": "msl-edit-projects"}
            ]
        },{
            "title": "Reports",
            "icon": "resources/images/report_ico_white.png",
            "class": "reports",
            "link": "msl-reports",
            "subItems": []
        }, {
            "title": "Profile",
            "icon": "resources/images/prof_ico_white.png",
            "class": "profile",
            "link": "profile",
            "subItems": [
                {"title": "View", "link": "msl-view-profile"},
                {"title": "Password", "link": "change-password"},
                {"title": "Subscriptions", "link": "my-subscriptions"},
                {"title": "Edit", "link": "msl-edit-profile"}
            ]
        }, {
            "title": "Calender",
            "icon": "resources/images/cal_ico_white.png",
            "class": "calender",
            "link": "my-calender",
            "subItems": []
        },{
            "title": "Help Topics",
            "icon": "resources/images/help_ico_white.png",
            "class": "help",
            "link": "help-topics",
            "subItems": []
        }
    ]

};

var Menu = function (container, data, dataSelector) {

    this.data = data;
    this.container = $(container);
    this.dataSelector = dataSelector;
    this.hoverStack = new Array();

};

Menu.prototype = {

    init: function () {

        if (this.data[this.dataSelector]) {
            var data = this.data[this.dataSelector];
            for (var i = 0; i < data.length; i++) {

                if (this.hasSubMenu(data[i])) {
                    this.createMenuItemWithSubItems(data[i]);
                } else {
                    this.createMenuItem(data[i]);
                }

            }
        }

        var _this = this;

        $(document).on('mousemove', function (e) {

            var toElem = $(e.target);
            if (toElem.hasClass("popover-wrapper") || _this.hasParentWith(toElem)) {

            } else {
                _this.cleanHoverStack();
                $('.sidebar-menu li.active .menu-selected-item').css('display','block');
            }

        });

    },
    createMenuItem: function (menuItemData) {

        var _this = this,
        	id = this._prepareId(menuItemData.title);
        var menuItemTemplate = '<li class=" ' + menuItemData.class + '">' +
            '<a class= "main-menu-item" id="' + id + '" href="' + menuItemData.link + '">' +
            '<img class="main-menu-icon" src="' + menuItemData.icon + '"/>' +
            ' <span class="main-menu-item-text">' + menuItemData.title + '</span>' +
            '<span class="menu-selected-item"></span>' +
            '</a>' +
            '</li>';

        var menuItem = $(menuItemTemplate);

        menuItem.appendTo(this.container);

        $('#' + id).hover(function () {
            _this.cleanHoverStack();
            $('.sidebar-menu li.active .menu-selected-item').css('display','none');
        }, function () {
        });


    },
    createMenuItemWithSubItems: function (menuItemData) {

        var _this = this,
        	id = this._prepareId(menuItemData.title);;
        var menuItemTemplate = '<li class=" ' + menuItemData.class + '">' +
            '<a class="main-menu-item cursor-normal" id="' + id + '" rel="popover" >' +
            '<img class="main-menu-icon" src="' + menuItemData.icon + '"/>' +
            ' <span class="main-menu-item-text">' + menuItemData.title + '</span>' +
            '<span class="menu-selected-item"></span>' +
            '</a>' +
            '</li>';

        var menuItem = $(menuItemTemplate);

        menuItem.appendTo(this.container);

        var popoverTemplate = ['<div class="popover popover-wrapper" style="width: ' + (menuItemData.subItems.length * 90 + 15) + 'px;">',
            '<div class=" custom-popover">',
            '<div class="arrow" style="display: none;"></div>',
            '<div class="popover-content">',
            '</div>',
            '</div>',
            '</div>'].join('');

        var content = new Array()

        for (var i = 0; i < menuItemData.subItems.length; i++) {

            var subItemTemplate = '<li class="custom-popover-inner-item"><a class="custom-popover-inner-item-text" href="' + menuItemData.subItems[i].link + '">' + menuItemData.subItems[i].title + '</a></li>';

            content.push(subItemTemplate);

        }

        content.join('');


        $('#' + id).popover({
            trigger: 'focus',
            content: content,
            template: popoverTemplate,
            html: true
        });

        $('#' + id).hover(function () {
            if (!_this.hasCurrentInStack(this)) {
                _this.cleanHoverStack();
                $('#' + id).popover('show');
                _this.hoverStack.push($('#' + id));
                $('.sidebar-menu li.active .menu-selected-item').css('display','none');
            }else{
            	
            }

        }, function () {
        });


    },
    hasSubMenu: function (menuItemData) {

        if (menuItemData.subItems && menuItemData.subItems.length > 0) {
            return true;
        }

        return false;

    },
    cleanHoverStack: function () {
        for (var i = 0; i < this.hoverStack.length; i++) {
            this.hoverStack[i].popover('hide');
        }
        this.hoverStack = new Array();
    },
    hasCurrentInStack: function (thisObj) {

        for (var i = 0; i < this.hoverStack.length; i++) {
            if (this.hoverStack[i].attr('id') === $(thisObj).attr('id'))
                return true;
        }

        return false;

    },
    hasParentWith: function (elem) {

        var hasParent = elem.parents(".sidebar-menu");

        if (hasParent.length > 0) {
            return true;
        }

        return false;

    },
    _prepareId : function(text){
    	return text.replace(" ","-");
    }


};